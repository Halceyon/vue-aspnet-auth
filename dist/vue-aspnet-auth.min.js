/*!
 * vue-aspnet-auth v1.0.0
 * Copyright Code HQ (Pty) Ltd.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.VueAspnetAuth={})}(this,function(e){"use strict";function t(e,t,s){var n;if(s){var r=new Date;r.setTime(r.getTime()+1e3*s),n="; expires="+r.toGMTString()}else n="";document.cookie=encodeURIComponent(e)+"="+encodeURIComponent(t)+n+"; path=/"}function s(e){for(var t=encodeURIComponent(e)+"=",s=document.cookie.split(";"),n=0;n<s.length;n++){for(var r=s[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(t))return decodeURIComponent(r.substring(t.length,r.length))}return null}function n(e){t(e,"",-1)}function r(e){t("aspnetAuthToken",e.access_token),t("apnetAuth",JSON.stringify(e))}function o(){u.authentication=JSON.parse(s("apnetAuth"))}var u={authentication:null,user:{},url:"",register:function(e,t,s,n){console.log(this),$.ajax({method:"POST",url:this.url+"/api/account/register",data:{Username:e,Password:t,ConfirmPassword:s},error:function(e){if(500===e.status)n({result:!1,message:"Server error, please try again later."});else{var t=[];for(var s in e.responseJSON.ModelState)e.responseJSON.ModelState[s].forEach(function(e){t.push(e)});n({result:!1,message:"",errors:t})}},success:function(e){n({result:!0,message:e})}})},forgot:function(e,t){$.ajax({url:this.url+"/api/account/forgotpassword",method:"POST",data:{email:e},success:function(e){t({result:!0,message:"Password reset email sent successfully"})},error:function(e){t({result:!1,message:"Error requesting password reset"})}})},login:function(e,t,s){$.ajax({url:this.url+"/token",method:"POST",data:{username:e,password:t,grant_type:"password",client_id:"jsApp"},success:function(e){r(e),o(),s({result:!0,message:"User logged in successfully"})},error:function(e){s({result:!1,message:e.responseJSON.error_description})}})},loginExternal:function(e,t){$.get(this.url+"/api/account/ObtainLocalAccessToken",e,function(e){r(e),o(),t({result:"success",message:"User logged in successfully"})})},logout:function(e){n("aspnetAuthToken"),n("apnetAuth"),e({result:"success",message:"User logged out successfully"})},refreshToken:function(e){this.authentication.refresh_token;$.ajax({url:this.url+"/token",method:"POST",data:{grant_type:"refresh_token",refresh_token:this.authentication.refresh_token,client_id:"jsApp"},success:function(t){r(t),o(),e({result:"success",message:"Token refreshed"})},error:function(t){e({result:"failed",message:t.responseJSON.error_description})}})},fillAuth:function(){o()},web:{get:function(e,t){$.ajax({url:u.url+e,headers:{Authorization:"Bearer "+s("aspnetAuthToken")},method:"GET",success:function(e){t(e)},error:function(e){t(e)}})}}};o(),e.aspnetAuth=u,Object.defineProperty(e,"__esModule",{value:!0})});